service:
  name: letspoll

custom:
    accountId: AWS::AccountId

frameworkVersion: ">=1.0.0 <2.0.0"


plugins:
  - serverless-cf-vars

provider:
  name: aws
  runtime: java8
  stage: ${opt:stage,'beta'} # Set the default stage used. Default is dev
  region: ${opt:region,'ap-south-1'} # Overwrite the default region used. Default is us-east-1
  profile: ${opt:profile,'lets-poll-default'}
# The "Resources" your "Functions" use.  Raw AWS CloudFormation goes in here.
resources:
  - ${file(./resources/vpc.yml)}
  #- ${file(./resources/rds.yml)}
  - ${file(./resources/cognito.yml)}
  - ${file(./resources/lambdaExecutionRole.yml)}
  - ${file(./resources/lambdaBasicExecutionPolicy.yml)}
  - ${file(./resources/lambdaVpcPolicy.yml)}
  - ${file(./resources/api.yml)}
  - ${file(./resources/kms.yml)}
  #- $(file)(./resources/functions.yml)
package:
  artifact: build/libs/letsPollApi-all.jar

functions:
  greeter:
    handler: com.serverless.handlers.PollGetter
    #awsKmsKeyArn:
    #  Ref: letsPollKMSKey
      #Fn::GetAtt: letsPollKMSKey
    environment:
      databaseUsername: ${env:LP_DATABASE_USERNAME}
      databasePassword: ${env:LP_DATABASE_PASSWORD}
      databaseUrl: ${env:LP_DATABASE_URL}
      databasePort: ${env:LP_DATABASE_PORT}
      databaseName: ${env:LP_DATABASE_NAME}
    events:
      - http:
          path: /ping
          method: get
          cors: true


          documentation:
            summary: Gets a simple message
            tags:
              - Tag1
            description: >
              Demonstrates a GET method. You can see query string parameters,
              request headers, response body and response headers.
            queryParams:
              -
                name: firstParam
                description: The first param that we want, you MUST pass it
                required: true
              -
                name: secondParam
                description: The second param. This one is optional
            methodResponses:
              -
                statusCode: '200'
                responseModels:
                  "application/json": "string"
                responseHeaders:
                  -
                    name: link
                    description: describes other actions that can be taken
                    type: string




#Outputs:
#    letsPollVPCID:
#      Description: The VPC id for LetsPoll VPC
#      Value:
#        Ref: letsPollVPC
#      Export:
#        Name: ${self:service}:letsPollVPCId # see Fn::ImportValue to use in other services and http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html for documentation on use.

#    letsPollIGWID:
#      Description: The VPC id for LetsPoll VPC
#      Value:
#        Ref: letsPollIGW
#      Export:
#        Name: ${self:service}:letsPollIGWId # see Fn::ImportValue to use in other services and http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html for documentation on use.
